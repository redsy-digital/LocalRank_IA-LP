// ====================================================================================
// 1. OBJETO DE TRADUÃ‡Ã•ES (i18n)
// ====================================================================================

const translations = {
    "pageTitleIndex": {
        "pt": "LocalRank IA â€” PrÃ©-LanÃ§amento",
        "en": "LocalRank AI â€” Pre-Launch",
        "es": "LocalRank IA â€” Prelanzamiento"
    },
    "pageTitleForm": {
        "pt": "PrÃ©-LanÃ§amento â€” LocalRank IA",
        "en": "Pre-Launch â€” LocalRank AI",
        "es": "Prelanzamiento â€” LocalRank IA"
    },
    "heroTitle": {
        "pt": "Cansado de ver os seus concorrentes no topo do Google Maps?",
        "en": "Tired of seeing your competitors at the top of Google Maps?",
        "es": "Â¿Cansado de ver a tus competidores en la cima de Google Maps?"
    },
    "heroSubtitle": {
        "pt": "Chegou o <strong>piloto automÃ¡tico para o seu negÃ³cio local</strong>. Otimize o seu Perfil de Empresa no Google, responda clientes e atraia mais visitasâ€¦ <strong>enquanto dorme.</strong>",
        "en": "The <strong>autopilot for your local business</strong> has arrived. Optimize your Google Business Profile, respond to customers, and attract more visitsâ€¦ <strong>while you sleep.</strong>",
        "es": "Ha llegado el <strong>piloto automÃ¡tico para tu negocio local</strong>. Optimiza tu Perfil de Empresa en Google, responde a clientes y atrae mÃ¡s visitasâ€¦ <strong>mientras duermes.</strong>"
    },
    "btnMegaDiscount": {
        "pt": "Garantir Mega Desconto",
        "en": "Secure Mega Discount",
        "es": "Asegurar Mega Descuento"
    },
    "sectionTitleProblem": {
        "pt": "O Problema",
        "en": "The Problem",
        "es": "El Problema"
    },
    "cardProblem1Title": {
        "pt": "AvaliaÃ§Ãµes sem resposta?",
        "en": "Unanswered Reviews?",
        "es": "Â¿ReseÃ±as sin respuesta?"
    },
    "cardProblem1Text": {
        "pt": "Cada review ignorado Ã© um cliente perdido e um sinal negativo para o Google.",
        "en": "Every ignored review is a lost customer and a negative signal for Google.",
        "es": "Cada reseÃ±a ignorada es un cliente perdido y una seÃ±al negativa para Google."
    },
    "cardProblem2Title": {
        "pt": "Perfil desatualizado?",
        "en": "Outdated Profile?",
        "es": "Â¿Perfil desactualizado?"
    },
    "cardProblem2Text": {
        "pt": "Um perfil inativo perde relevÃ¢ncia e posiÃ§Ãµes no ranking todos os dias.",
        "en": "An inactive profile loses relevance and ranking positions every day.",
        "es": "Un perfil inactivo pierde relevancia y posiciones en el ranking todos los dÃ­as."
    },
    "cardProblem3Title": {
        "pt": "Sem tempo para marketing?",
        "en": "No Time for Marketing?",
        "es": "Â¿Sin tiempo para marketing?"
    },
    "cardProblem3Text": {
        "pt": "VocÃª tem um negÃ³cio para gerir. NÃ£o para decifrar algoritmos.",
        "en": "You have a business to run. Not to decipher algorithms.",
        "es": "Tienes un negocio que gestionar. No para descifrar algoritmos."
    },
    "sectionTitleSolution": {
        "pt": "A SoluÃ§Ã£o",
        "en": "The Solution",
        "es": "La SoluciÃ³n"
    },
    "cardSolution1Title": {
        "pt": "Respostas Inteligentes",
        "en": "Smart Responses",
        "es": "Respuestas Inteligentes"
    },
    "cardSolution1Text": {
        "pt": "A IA analisa o sentimento de cada review e cria respostas profissionais.",
        "en": "AI analyzes the sentiment of each review and creates professional responses.",
        "es": "La IA analiza el sentimiento de cada reseÃ±a y crea respuestas profesionales."
    },
    "cardSolution2Title": {
        "pt": "Posts Semanais AutomÃ¡ticos",
        "en": "Automatic Weekly Posts",
        "es": "Publicaciones Semanales AutomÃ¡ticas"
    },
    "cardSolution2Text": {
        "pt": "Perfil sempre ativo com conteÃºdos relevantes gerados pela IA.",
        "en": "Always active profile with relevant content generated by AI.",
        "es": "Perfil siempre activo con contenido relevante generado por IA."
    },
    "cardSolution3Title": {
        "pt": "RelatÃ³rios Claros",
        "en": "Clear Reports",
        "es": "Informes Claros"
    },
    "cardSolution3Text": {
        "pt": "Veja crescimento real: mais chamadas, mais visitas, mais clientes.",
        "en": "See real growth: more calls, more visits, more customers.",
        "es": "Vea crecimiento real: mÃ¡s llamadas, mÃ¡s visitas, mÃ¡s clientes."
    },
    "offerTitle": {
        "pt": "Mega LanÃ§amento",
        "en": "Mega Launch",
        "es": "Mega Lanzamiento"
    },
    "offerSubtitle": {
        "pt": "Seja um dos primeiros. <strong>Garanta um desconto que nunca mais se vai repetir.</strong>",
        "en": "Be one of the first. <strong>Secure a discount that will never be repeated.</strong>",
        "es": "SÃ© uno de los primeros. <strong>Asegura un descuento que nunca se repetirÃ¡.</strong>"
    },
    "offerListItem1": {
        "pt": "ðŸ“† PerÃ­odo de <strong>7 dias</strong> de teste grÃ¡tis",
        "en": "ðŸ“† <strong>7-day</strong> free trial period",
        "es": "ðŸ“† PerÃ­odo de prueba gratuita de <strong>7 dÃ­as</strong>"
    },
    "offerListItem2": {
        "pt": "ðŸš€ Mais de <strong>60% de desconto</strong> nos primeiros 3 meses",
        "en": "ðŸš€ Over <strong>60% discount</strong> for the first 3 months",
        "es": "ðŸš€ MÃ¡s del <strong>60% de descuento</strong> durante los primeros 3 meses"
    },
    "offerListItem3": {
        "pt": "âš¡ Acesso prioritÃ¡rio antes de todos",
        "en": "âš¡ Priority access before everyone else",
        "es": "âš¡ Acceso prioritario antes que nadie"
    },
    "offerListItem4": {
        "pt": "ðŸ’¬ InfluÃªncia direta nas prÃ³ximas funcionalidades",
        "en": "ðŸ’¬ Direct influence on upcoming features",
        "es": "ðŸ’¬ Influencia directa en las prÃ³ximas funcionalidades"
    },
    "offerListItem5": {
        "pt": "ðŸŽ¯ Apenas para os <strong>150 primeiros</strong>",
        "en": "ðŸŽ¯ Only for the <strong>first 150</strong>",
        "es": "ðŸŽ¯ Solo para los <strong>primeros 150</strong>"
    },
    "spotsText": {
        "pt": "Restam aproximadamente <strong>67%</strong> das vagas",
        "en": "Approximately <strong>67%</strong> of spots remain",
        "es": "Queda aproximadamente el <strong>67%</strong> de las plazas"
    },
    "footerText": {
        "pt": "Â© 2025 LocalRank IA â€” Todos os direitos reservados",
        "en": "Â© 2025 LocalRank AI â€” All rights reserved",
        "es": "Â© 2025 LocalRank IA â€” Todos los derechos reservados"
    },
    // FORM.HTML STRINGS
    "formTitle": {
        "pt": "Responda Ã s QuestÃµes",
        "en": "Answer the Questions",
        "es": "Responde a las Preguntas"
    },
    "formSubtitle": {
        "pt": "Antes de entrar no grupo de prÃ©-lanÃ§amento, responda este formulÃ¡rio rÃ¡pido. Isso ajuda-nos a adaptar melhor o LocalRank IA Ã s suas necessidades.",
        "en": "Before joining the pre-launch group, please answer this quick form. This helps us better adapt LocalRank AI to your needs.",
        "es": "Antes de unirte al grupo de prelanzamiento, responde este formulario rÃ¡pido. Esto nos ayuda a adaptar mejor LocalRank IA a tus necesidades."
    },
    "labelCountry": {
        "pt": "PaÃ­s",
        "en": "Country",
        "es": "PaÃ­s"
    },
    "selectPlaceholder": {
        "pt": "Selecione",
        "en": "Select",
        "es": "Selecciona"
    },
    "countryPortugal": {
        "pt": "Portugal",
        "en": "Portugal",
        "es": "Portugal"
    },
    "countryBrazil": {
        "pt": "Brasil",
        "en": "Brazil",
        "es": "Brasil"
    },
    "countrySpain": {
        "pt": "Espanha",
        "en": "Spain",
        "es": "EspaÃ±a"
    },
    "countryUSA": {
        "pt": "Estados Unidos",
        "en": "United States",
        "es": "Estados Unidos"
    },
    "countryUK": {
        "pt": "Reino Unido",
        "en": "United Kingdom",
        "es": "Reino Unido"
    },
    "countryAngola": {
        "pt": "Angola",
        "en": "Angola",
        "es": "Angola"
    },
    "countryMozambique": {
        "pt": "MoÃ§ambique",
        "en": "Mozambique",
        "es": "Mozambique"
    },
    "countryChile": {
        "pt": "Chile",
        "en": "Chile",
        "es": "Chile"
    },
    "countryMexico": {
        "pt": "MÃ©xico",
        "en": "Mexico",
        "es": "MÃ©xico"
    },
    "countryArgentina": {
        "pt": "Argentina",
        "en": "Argentina",
        "es": "Argentina"
    },
    "labelPreferredLang": {
        "pt": "Idioma preferido",
        "en": "Preferred Language",
        "es": "Idioma preferido"
    },
    "langPT": {
        "pt": "PortuguÃªs",
        "en": "Portuguese",
        "es": "PortuguÃ©s"
    },
    "langEN": {
        "pt": "InglÃªs",
        "en": "English",
        "es": "InglÃ©s"
    },
    "langES": {
        "pt": "Espanhol",
        "en": "Spanish",
        "es": "EspaÃ±ol"
    },
    "labelBusinessType": {
        "pt": "Tipo de negÃ³cio",
        "en": "Business Type",
        "es": "Tipo de negocio"
    },
    "placeholderBusinessType": {
        "pt": "Ex: Restaurante, ClÃ­nica, Loja...",
        "en": "Ex: Restaurant, Clinic, Store...",
        "es": "Ej: Restaurante, ClÃ­nica, Tienda..."
    },
    "labelBusinessSize": {
        "pt": "Tamanho do negÃ³cio",
        "en": "Business Size",
        "es": "TamaÃ±o del negocio"
    },
    "sizeSelfEmployed": {
        "pt": "AutÃ´nomo",
        "en": "Self-Employed",
        "es": "AutÃ³nomo"
    },
    "sizeSmall": {
        "pt": "Pequeno negÃ³cio",
        "en": "Small Business",
        "es": "PequeÃ±o negocio"
    },
    "sizeMedium": {
        "pt": "MÃ©dio negÃ³cio",
        "en": "Medium Business",
        "es": "Mediano negocio"
    },
    "sizeAgency": {
        "pt": "AgÃªncia",
        "en": "Agency",
        "es": "Agencia"
    },
    "labelChallenge": {
        "pt": "Maior desafio no Google / Marketing Local",
        "en": "Biggest Challenge in Google / Local Marketing",
        "es": "Mayor desafÃ­o en Google / Marketing Local"
    },
    "placeholderChallenge": {
        "pt": "Descreva em poucas palavras",
        "en": "Describe in a few words",
        "es": "Describe en pocas palabras"
    },
    "labelGMB": {
        "pt": "JÃ¡ utiliza o Google Meu NegÃ³cio?",
        "en": "Do you already use Google My Business?",
        "es": "Â¿Ya utilizas Google My Business?"
    },
    "gmbYes": {
        "pt": "Sim",
        "en": "Yes",
        "es": "SÃ­"
    },
    "gmbNo": {
        "pt": "NÃ£o",
        "en": "No",
        "es": "No"
    },
    "gmbHeardOf": {
        "pt": "JÃ¡ ouvi falar",
        "en": "I've heard of it",
        "es": "He oÃ­do hablar de ello"
    },
    "labelEmail": {
        "pt": "Email (opcional)",
        "en": "Email (optional)",
        "es": "Email (opcional)"
    },
    "placeholderEmail": {
        "pt": "Para novidades e acesso antecipado",
        "en": "For news and early access",
        "es": "Para novedades y acceso anticipado"
    },
    "btnSubmitForm": {
        "pt": "Entrar no PrÃ©-LanÃ§amento",
        "en": "Join Pre-Launch",
        "es": "Unirse al Prelanzamiento"
    },
    "formSuccess": {
        "pt": "FormulÃ¡rio enviado com sucesso! A redirecionar para o grupo de WhatsApp...",
        "en": "Form submitted successfully! Redirecting to the WhatsApp group...",
        "es": "Â¡Formulario enviado con Ã©xito! Redirigiendo al grupo de WhatsApp..."
    },
    "formError": {
        "pt": "Erro ao enviar o formulÃ¡rio. Por favor, tente novamente.",
        "en": "Error submitting the form. Please try again.",
        "es": "Error al enviar el formulario. Por favor, intÃ©ntalo de nuevo."
    }
};

// ====================================================================================
// 2. LÃ“GICA DE DETEÃ‡ÃƒO E APLICAÃ‡ÃƒO
// ====================================================================================

const DEFAULT_LANG = 'pt';
const SUPPORTED_LANGS = ['pt', 'en', 'es'];

/**
 * Deteta o idioma preferido do utilizador com base no navegador.
 * @returns {string} O cÃ³digo do idioma ('pt', 'en', ou 'es').
 */
function detectLanguage() {
    const browserLang = navigator.language.toLowerCase().split('-')[0];
    
    // Verifica se o idioma do navegador Ã© suportado
    if (SUPPORTED_LANGS.includes(browserLang)) {
        return browserLang;
    }

    // Verifica por idiomas mais amplos (ex: pt-BR, pt-PT -> pt)
    for (const lang of navigator.languages) {
        const baseLang = lang.toLowerCase().split('-')[0];
        if (SUPPORTED_LANGS.includes(baseLang)) {
            return baseLang;
        }
    }

    // Retorna o idioma padrÃ£o se nÃ£o for detetado nenhum suportado
    return DEFAULT_LANG;
}

/**
 * Aplica as traduÃ§Ãµes a todos os elementos com o atributo data-i18n.
 * @param {string} lang - O cÃ³digo do idioma a aplicar.
 */
function applyTranslation(lang) {
    // 1. Traduzir o corpo do documento
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[key] && translations[key][lang]) {
            element.innerHTML = translations[key][lang];
        }
    });

    // 2. Traduzir placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[key] && translations[key][lang]) {
            element.placeholder = translations[key][lang];
        }
    });

    // 3. Traduzir o tÃ­tulo da pÃ¡gina
    const titleKey = document.title.includes("PrÃ©-LanÃ§amento") ? "pageTitleForm" : "pageTitleIndex";
    if (translations[titleKey] && translations[titleKey][lang]) {
        document.title = translations[titleKey][lang];
    }

    // 4. Atualizar o botÃ£o de idioma
    const langSwitch = document.querySelector('.lang-switch');
    if (langSwitch) {
        langSwitch.textContent = lang.toUpperCase();
    }

    // 5. Guardar o idioma na sessÃ£o
    localStorage.setItem('currentLang', lang);
}

/**
 * Alterna para o prÃ³ximo idioma na lista de suportados.
 */
function toggleLanguage() {
    const currentLang = localStorage.getItem('currentLang') || DEFAULT_LANG;
    const currentIndex = SUPPORTED_LANGS.indexOf(currentLang);
    const nextIndex = (currentIndex + 1) % SUPPORTED_LANGS.length;
    const nextLang = SUPPORTED_LANGS[nextIndex];
    applyTranslation(nextLang);
}

// ====================================================================================
// 3. INICIALIZAÃ‡ÃƒO
// ====================================================================================

document.addEventListener('DOMContentLoaded', () => {
    // 1. Detetar ou carregar o idioma
    let initialLang = localStorage.getItem('currentLang');
    if (!initialLang) {
        initialLang = detectLanguage();
    }

    // 2. Aplicar a traduÃ§Ã£o inicial
    applyTranslation(initialLang);

    // 3. Ligar o botÃ£o de alternÃ¢ncia
    const langSwitch = document.querySelector('.lang-switch');
    if (langSwitch) {
        langSwitch.addEventListener('click', toggleLanguage);
    }
});
